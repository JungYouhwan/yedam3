<!DOCTYPE html>
<html xmlns:th="https://www.thymeleaf.org/"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{common/layouts/default_layout}">
<body>
	<th:block layout:fragment="Content">
		<div class="container">
			<form name="insertForm" th:action="@{/prjtInsert}" method="post" 
			th:object="${projects}" id="prjtForm">   
				 <br><br><br>    
                    <div style=" text-align: center;">
                    	<button type="button" th:onclick="|location.href='@{/prjtInsert}'|" class="btn btn-primary">프로젝트 등록</button>
                    	<button type="button" th:onclick="|location.href='@{/taskInsert}'|" class="btn btn-primary">프로젝트 업무등록</button>
                    	<button type="button" th:onclick="|location.href='@{/reguInsert}'|" class="btn btn-primary">상시업무 등록</button>
                    </div> 
                    <br>                     
				<table id="form" class="table">
					<h3>프로젝트 등록</h3>
					<tr>
						<th>프로젝트ID</th>
						<td><input type="text" th:field="*{prjtId}" readonly></td>
					</tr>
					<tr>
						<th>프로젝트명</th>
						<td><input type="text" th:field="*{prjtName}"></td>
					</tr>
					<tr>
						<th>시작일</th>
						<td><input type="date" th:field="*{prjtStartDt}"></td>
					</tr>
					<tr>
						<th>마감일</th>
						<td><input type="date" th:field="*{prjtDueDt}"></td>
					</tr>
					<tr>
						<th>책임자</th>
						<td>
							<input type="text" th:field="*{respMngrId}" placeholder="버튼을 눌러 선택하세요" id="mngrResult">
							<button type="button"  class="btn btn-primary" 
							id="respMngrId" data-bs-toggle="modal" data-bs-target="#respModal">선택</button>
						</td>
					</tr>
					<tr>
						<th>개요</th>
						<td><input type="text" th:field="*{smry}"></td>
					</tr>
					<tr>
						<th>목적</th>
						<td><textarea cols="50" th:field="*{purpose}"></textarea></td>
					</tr>
				</table>
				<div style=" text-align: center;">
					<button type="button" class="btn btn-primary" id="prjtInsertBtn" onclick="prjtInsertBtn">저장</button>
					<button type="button" class="btn btn-secondary" >취소</button>
				</div>
			</form>
		</div>
		<!------------------------------------------------ 모달 -------------------------------------------------->
		<!-- 총괄책임자 등록 모달창 -->
		<div  class="modal fade" id="respModal" tabindex="-1" aria-labelledby="respModalLabel" aria-hidden="true">
			<div class="modal-dialog" style=" text-align: center;">
				<div class=" modal-content">
					<div class="modal-header" style=" text-align: center">
						<h5 class="modal-title" id="respModalLabel" >책임자 선택</h5>
						<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
					</div>
			
					<table class="table table-light table-sm">
						<thead>
							<tr>
								<th>부서명</th>
								<th>직급명</th>
								<th>성명</th>
								<th>선택</th>
							</tr>
						</thead>
						<tbody>
							<th:block th:each="mngr : ${mngr}">
								<tr>
										<td>[[ ${mngr.deptName} ]]</td>
										<td>[[ ${mngr.jobTitle} ]]</td>
										<td>[[ ${mngr.empName} ]]</td>
										<td> <input class="form-radio-input" type="radio" name="mngrCheck"></td>
								</tr>
							</th:block>	
						</tbody>
					</table>
					<div class="modal-footer">
						<button type="button" class="btn btn-primary" id="respInBtn">등록</button>
						<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">취소</button>
					</div>
				</div>
			</div>
		</div> 
	</th:block>
</body>
		
		<!------------------------------------------------ 모달 끝-------------------------------------------------->
		<script>
			// 책임자이름 선택 등록  
			$(function(){	
				$('#respInBtn').on('click', function() {
					let chkMngr = $("input[name=mngrCheck]:checked").val();
						
					if(chkMngr.length > 0) {
						
						let checked = first().closest('tr').find().'td:eq(2)'text();
						
						$('#mngrResult').val(checked);
					}
				}); 
			}); 
			
			// 등록
			$(function(){
				$('#prjtInsertBtn').on('click', function(){
					let formData = $('#prjtForm').serialize();
					console.log(formData);
					$.ajax({
						type: 'POST',
						url : '/prjtInsert',
						data : formData,
						success : function(data){
							alert('프로젝트 등록에 성공했습니다.');
							location.reload();
						},
						error : function(err){
							alert('프로젝트 등록에 실패했습니다.');
						}
					});
				});
			});
				
	</script>
</html>








