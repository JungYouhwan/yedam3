<!DOCTYPE html>
<html xmlns:th="https://www.thymeleaf.org/"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{common/layouts/default_layout}">
<body>
	<th:block layout:fragment="Content">
		<div class="container container-p-y mt-3">
			<h2>프로젝트 수정</h2>
			<div class="bg-light p-3 m-5">
				<form th:action="@{/project/update}" method="post">
					<div class="table-responsive">
						<input type="hidden" th:value="${prjt.prjtId}" id="prjtId" name="prjtId" readonly />
						<div class="table-responsive">
							<table class="table table-hover table-bordered">
								<tr>
									<th>프로젝트ID</th>
									<td>[[ ${prjt.prjtId} ]]</td>
									<th>프로젝트명</th>
									<td><input type="text" th:field="*{prjtName}" /></td>
									<th>책임자</th>
									<td>
										<input type="hidden" th:field="*{respMngrId}" style="width: 230px">
										<input type="text" id="respMngrName" placeholder="버튼을 눌러 선택하세요">&ensp;
										<button type="button" class="btn btn-primary" id="respMngrId"
											data-bs-toggle="modal" data-bs-target="#respModal">선택</button>
									</td>
									<th>진행상황</th>
									<td><input type="text" th:field="*{prjtStat}" /></td>
								</tr>
							</table>
							<br>
							<table class="table table-hover table-bordered">
								<tr>
									<th>시작일</th>
									<td><input type="date" th:field="*{prjtStartDt}" /></td>
									<th>마감일</th>
									<td><input type="date" th:field="*{prjtDueDt}" /></td>
								</tr>
							</table>
							<br>
							<table class="table table-hover table-bordered">
								<thead>
									<tr>
										<th>목적</th>
										<td><textarea th:field="*{purpose}"></textarea></td>
										<th>개요</th>
										<td><textarea th:field="*{smry}"></textarea></td>
									</tr>
								</thead>
							</table>
							<br>
							<div style="text-align: end">
								<button type="button" class="btn btn-primary mt-2" id="updateBtn">저장</button>
								<button type="button" class="btn btn-light mt-2"
									onclick="goToList()">취소</button>
							</div>
						</div>
					</div>
				</form>
			</div>
		</div>
		
		<!------------------------------------------------ 모달 -------------------------------------------------->
		<!-- 총괄책임자 등록 모달창 -->
		<div class="modal fade" id="respModal" tabindex="-1"
			aria-labelledby="respModalLabel" aria-hidden="true">
			<div class="modal-dialog" style="text-align: center;">
				<div class="modal-content">
					<div class="modal-header" style="text-align: center">
						<h5 class="modal-title" id="respModalLabel">책임자 선택</h5>
						<button type="button" class="btn-close" data-bs-dismiss="modal"
							aria-label="Close"></button>
					</div>

					<table class="table table-light table-sm">
						<thead>
							<tr>
								<th>부서명</th>
								<th>직급명</th>
								<th>성명</th>
								<th>선택</th>
							</tr>
						</thead>
						<tbody>
							<th:block th:each="mngr : ${mngr}">
								<tr>
									<td>[[ ${mngr.deptName} ]]</td>
									<td>[[ ${mngr.jobTitle} ]]</td>
									<td>[[ ${mngr.empName} ]]</td>
									<td>
										<input class="form-radio-input" type="radio"
											name="mngrCheck" th:value="${mngr.empId}">
									</td>
								</tr>
							</th:block>
						</tbody>
					</table>
					<div class="modal-footer">
						<button type="button" class="btn btn-primary" id="respInBtn"
							data-bs-dismiss="modal">등록</button>
						<button type="button" class="btn btn-secondary"
							data-bs-dismiss="modal">취소</button>
					</div>
				</div>
			</div>
		</div>
		<!------------------------------------------------ 모달 끝-------------------------------------------------->
	
		<script>
		    $(document).ready(function() {
		 
		        $('#updateBtn').click(function() {
		            let project = {
		                prjtId: $('#prjtId').val(),
		                prjtName: $('#prjtName').val(),
		                respMngrId: $('#respMngrId').val(),
		                prjtStat: $('#prjtStat').val(),
		                prjtStartDt: $('#prjtStartDt').val(),
		                prjtDueDt: $('#prjtDueDt').val(),
		                purpose: $('#purpose').val(),
		                smry: $('#smry').val()
		            };
		
		            $.ajax({
		                url: '/cust/prjtUpdate',
		                type: 'POST',
		                contentType: 'application/json',
		                data: JSON.stringify(project),
		                success: function(response) {
		                    alert('프로젝트가 성공적으로 업데이트되었습니다.');
		                    window.location.href = '/cust/pj/info?prjtId=' + project.prjtId;
		                },
		                error: function(xhr, status, error) {
		                    alert('프로젝트 업데이트에 실패했습니다.');
		                    console.error(error);
		                }
		            });
		        });
		    });
		    
		</script>
	</th:block>
</body>
</html>