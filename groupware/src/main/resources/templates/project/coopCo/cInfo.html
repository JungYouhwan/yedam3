<!DOCTYPE html>
<html xmlns:th="https://www.thymeleaf.org/"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{common/layouts/default_layout}">
<body>
	<th:block layout:fragment="Content">
		<div class="container container-p-y mt-3">
			<h2>협력업체 상세</h2>
			<div class="bg-light p-3 m-5">
				<div class="table-responsive">
					<input type="hidden" th:value="${coop.coopCoNo}" id="coopCoNo" readonly />
					<div class="table-responsive">
						<table class="table table-hover table-bordered">
							<tr>
								<th>업체번호</th>
								<td id="coopCoNo">[[ ${coop.coopCoNo}]]</td>
								<th>업체명</th>
								<td>[[ ${coop.coName}]]</td>
								<th>업무명</th>
								<td  th:field="*{taskName}"> [[ ${coop.taskName}]]</td>
								<th>책임자</th>
								<td>[[ ${coop.pic}]]</td>
							</tr>
						</table>
						<br>
						<table class="table table-hover table-bordered">
							<thead>
								<tr>
									<th>연락처</th>
									<td>[[ ${coop.coTel}]]</td>
									<th>내용</th>
									<td>[[ ${coop.cntn}]]</td>
									<th>주소</th>
									<td>[[ ${coop.custAddr}]]</td>
								</tr>
							</tbody>
						</table>
						<br>
						<div style="text-align: end">
							<button type="button" class="btn btn-light  mt-2" onclick="goToList()">프로젝트목록</button>
							<button type="button" 
							  th:onclick="|location.href='@{/cust/coopUpdate(coopCoNo=${coop.coopCoNo})}'|" class="btn btn-success  mt-2">수정</button>
								<button type="button" class="btn btn-danger mt-2" id="delBtn">삭제</button>
						</div>
					</div>
				</div>
			</div>
		</div>

		<script>
		
			const token = document.querySelector('meta[name="_csrf"]').getAttribute('content');
			const header = document.querySelector('meta[name="_csrf_header"]').getAttribute('content');
			
			// 업무목록으로
			function goToList() {
				window.location.href = '/cust/coopAllList';
			};
			
			// 삭제 버튼
			$('#delBtn').on('click', function() {
				
			  $.ajax({
	                url: '/cust/coopDelete',
	                type: 'GET',
	                dataType : 'json',
	                beforeSend : function(xhr) {
						xhr.setRequestHeader(header, token); // 헤더에 CSRF 토큰 추가
					},
					success : function(data) {
						Swal.fire({
							title: '삭제완료!',        
							text:  '협력업체 삭제가 완료되었습니다.',  
							icon:  'success'
						})
						.then(function(){
							location.href='/cust/coopDelete?coopCoNo=' + coopCoNo;                  
						})
					},
					error : function(err) {
						Swal.fire({
							title: '삭제실패',        
							text:  '협력업체 삭제 실패하였습니다.',  
							icon:  'error'
						})
						.then(function(){
							location.href='/cust/coopAllList;                   
						})
	           	 });
			});
			
		</script>
	</th:block>
</body>
</html>