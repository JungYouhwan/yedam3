<!DOCTYPE html>
<html xmlns:th="https://www.thymeleaf.org/"
	  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	  layout:decorate="~{common/layouts/default_layout}">
	  
<th:block layout:fragment="Content">
<style>
.cust-table th{
	font-size: 0.9rem;
	font-weight: bold;
	text-align: center;
}

</style>

<div class="container container-p-y mt-3">
	<h4>고객관리 - 조회</h4>
	<div class="bg-light p-3">
		<div class="table-responsive">
			<div>
				<table class="table table-bordered cust-table">
					<tr class="table-primary">
						<th class="col-2">고객번호 <span id="cno">[[ ${cust.custNo} ]]</span></th>
						<th colspan="5" class="text-start align-middle">
							고객사 상세정보
						</th>
					</tr>
					<tr>
						<th class="col-2">사업자번호</th><td class="col-3">[[ ${cust.brn} ]]</td>
						<th class="col-1">상호명</th><td class="col-2">[[ ${cust.custName} ]]</td>
						<th class="col-1">대표자</th><td class="col-3">[[ ${cust.rep} ]]</td>
					</tr>
					<tr>
					</tr>
					<tr>
						<th>주소</th><td colspan="3">[[ ${cust.custAddr} ]]</td>
						<th>전화번호</th><td>[[ ${cust.custTel} ]]</td>
					</tr>
					<tr>
					</tr>
					<tr>
						<th>계약상태</th>
						<td>[[ ${cust.lastCtStatName} ]]
							<span ><a href="/sol/ctInsert" th:if="${cust.lastCtStat != '0A1a'}" class="text-danger">
							&emsp;신규계약 등록하기
							</a></span>
						</td>
						<th>계약번호</th>
						<td th:if="${cust.lastCtNo != null}">[[ ${cust.lastCtNo} ]]</td>
						<td th:unless="${cust.lastCtNo != null}">-</td>
						<th>결제담당</th><td>[[ ${cust.payPic} ]] &emsp;&emsp;(TEL : <span>[[ ${cust.payPicTel} ]]</span>)</td>
					</tr>
					<tr>
					</tr>
				</table>
				
			</div>
		</div>
	</div>
	
	<!-- 계정목록 -->
	<div th:if="${#arrays.length(list)} != 0">
		<p>있다</p>
		<!-- Emps Fragment -->
		<div id="EmpListArea">
			<th:block th:replace="solution/cust/modal :: Emps"></th:block>
		</div>
	</div>
	
	<div th:unless="${#arrays.length(list)} != 0">
		<p>없다</p>
		<div class="text-end">
			<button th:if="${cust.lastCtStat == '0A1a'}" type="button" id="firstEmp">최초계정생성</button>	
		</div>
	</div>
	
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
	
	const token = document.querySelector('meta[name="_csrf"]').getAttribute('content');
    const header = document.querySelector('meta[name="_csrf_header"]').getAttribute('content');
    
	if(document.getElementById('firstEmp') != null) {
	    document.getElementById('firstEmp').addEventListener('click', firstEmp);	
	}
    
	// 최초계정 생성 ajax.
   	function firstEmp(){
		let cno = document.getElementById('cno').innerText;
		let url = 'firstEmp';
		let obj = {custNo : cno}
		
		fetch(url, {
			method : 'post',
			body : JSON.stringify(obj),
			headers : {
				'Content-type' : 'application/json',
				[header]: token // [헤더네임]:토큰번호로 CSRF 토큰을 헤더에 포함
			}
		})
		.then(res => res.json())
		.then(ret => {
			
			console.log(ret);
			
		})
		.catch(err => console.error(err))		
   	}
	
	// offcanvas -> 계정목록.
	let offcanvasElement = document.getElementById('offcanvasEnd');
	offcanvasElement.addEventListener('show.bs.offcanvas', function(e) {
		 let content = document.getElementById('offcanvasEmps');
		 
		 var iframe = document.createElement('iframe');
		 iframe.src = 'https://www.naver.com'; // 불러올 웹사이트의 URL
	    iframe.width = '100%'; // 적절한 크기 지정
	    iframe.height = '100%'; // 적절한 크기 지정
	    iframe.style.border = 'none'; // 외곽선 없애기
	    content.appendChild(iframe); // Offcanvas에 iframe 삽입
	})
    
})
</script>

</th:block>
</html>