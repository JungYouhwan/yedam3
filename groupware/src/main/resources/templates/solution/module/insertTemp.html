<!DOCTYPE html>
<html xmlns:th="https://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{common/layouts/default_layout}">
<body>

	<th:block layout:fragment="Content">
		<div class="d-flex justify-content-center">
			<div class="card my-4 col-10">
				<h5 class="card-header">템플릿 등록</h5>
				<div class="card-body">
					<!-- 템플릿 등록/수정 -->
					<form>
						<div>
							<div class="card-body">
								<div class="mt-3 row">
									<label for="title" class="col-md-2 col-form-label">템플릿번호</label>
									<div class="col-md-10">
										<input class="form-control" type="text" />
									</div>
								</div>
								<div class="mt-3 row">
									<label for="title" class="col-md-2 col-form-label">사용고객사</label>
									<div class="col-md-10">
										<input class="form-control" type="text" />
									</div>
								</div>
								<div class="mt-3 row">
									<label for="title" class="col-md-2 col-form-label">템플릿번호</label>
									<div class="col-md-10">
										<input class="form-control" type="text" />
									</div>
								</div>
								<div class="mt-3 row">
									<label for="title" class="col-md-2 col-form-label">템플릿명</label>
									<div class="col-md-10">
										<input class="form-control" type="text" />
									</div>
								</div>
								<div class="mt-3 row">
									<label for="cntn" class="col-md-2 col-form-label">설명</label>
									<div class="col-md-10">
										<textarea class="form-control">...</textarea>
									</div>
								</div>
								<div class="mt-3">
									<label for="tempId" class="form-label">등록방식</label> <select
										class="form-select inserttype">
										<option value="option">-선택-</option>
										<option value="input">직접입력</option>
										<option value="upload">업로드</option>
									</select>
								</div>
							</div>
						</div>
					</form>

					<div style="display: none;" id="doctype">
						<textarea style="width: 790px; height: 200px;" id="content"></textarea>
						<div class="template"></div>

						<!-- 템플릿 등록 버튼 -->
						<div class="d-flex justify-content-center mb-3">
							<button type="button" class="btn btn-primary mx-2" id="htmlbtn">반영</button>

							<button type="button" class="btn btn-primary mx-2" id="htmlreset">초기화</button>
						</div>
					</div>
					<div style="display: none;" id="docupload">
						<div class="test">
							<input name="uploadFiles2" type="file" multiple>
							<button class="uploadBtn2">업로드</button>
						</div>
						<div class="test2"></div>
					</div>
					<div class="mt-3 text-end">
						<button type="submit" class="btn rounded-pill btn-primary">작성완료</button>
					</div>

					<script>
						$(".inserttype").on("change", function(e) {
							if ($(".inserttype").val() == "input") {
								$("#doctype").css('display', 'block');
								$("#docupload").css('display', 'none');
							} else if($(".inserttype").val() == "upload"){
								$("#docupload").css('display', 'block');
								$("#doctype").css('display', 'none');
							} else{
								$("#docupload").css('display', 'none');
								$("#doctype").css('display', 'none');
							}
						});

						$("#htmlbtn").on("click", function(e) {
							$(".template").html($("#content").val());
						});

						$("#htmlreset").on("click", function(e) {
							$(".template").empty();
						});
						
						//jQuery.ajax
						document.querySelector('.uploadBtn2').addEventListener('click', function(e){
							let formData = new FormData(); // 유사) jQuery.serialize() or jQuery.serializeArray()
							// 1) Form 태그 내부의 데이터를 한번에 담음
							// 2) Ajax를 이용해서 'Content-type:multipart/form-data'를 보내야 하는경우 사용
							
							let fileInput = document.querySelector('input[name="uploadFiles2"]');
							let fileList = fileInput.files;

							for(let file of fileList){
								formData.append('uploadFiles', file);
							}
							
					         $.ajax({
					             url: 'uploadsAjax',	
					             type: 'POST',
					             processData: false,	
					             //기본값은 true, ajax 통신을 통해 데이터를 전송할 때, 기본적으로 key와 value값을 Query String으로 변환해서 보냅니다.
					             contentType: false,	
					             // multipart/form-data타입을 사용하기위해 false 로 지정합니다.
					             data: formData,               
					             success: function(result){
					            	 console.log(result);
					                 for(let image of result){
					              	   let imgTag = $('<img/>').prop('src', 'images/'+ image)
					              	   						   .css('width', '50%');
					              	   $('div.test2').append(imgTag);
					                 }
					                 $.ajax({
					                	    url: 'images/' + result,	// HTML 파일 가져올 경로
					                	    dataType: "html",
					                	    success: function (html){
												console.log(html);
					                	    	$('div.test2').html(html); // HTML 코드 붙여넣기

					                	        /* $.getScript({
					                	            url: "file.js",		// script 가져올 경로
					                	            success: function () {	 // 스크립트 가져온 후에 실행할 코드
					                	               
					                	            }
					                	        }); */
					                	    }
					                	});
					             },
					             error: function(reject){	
					                 console.log(reject);
					             }
					         });
						})
					</script>
				</div>
			</div>
		</div>
	</th:block>
</body>
</html>