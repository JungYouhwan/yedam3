<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.samjo.app.approval.mapper.DocMapper">

	<select id="selectDocAll" parameterType="searchVO" resultType="DocVO">
		SELECT rn,
		       doc_no,
		       draft,
		       dept_id,
		       title,
		       cntn,
		       draft_dt,
		       draft_stat,
		       temp_id,
		       final_line,
		       now_line,
		       doc_stat,
		       cmplt_dt
		FROM (SELECT /*+ INDEX(DOC DOC_DOC_NO_PK) */
		            rownum rn,
		            doc.*
		      FROM  doc
		      WHERE rownum <![CDATA[<=]]> (#{page} * 3)) a
		WHERE  a.rn > (#{page} - 1) * 3	
	</select>

	<select id="count">
		SELECT count(*)
		FROM doc
	</select>

	<select id="selectDoc" resultType="DocVO">
		SELECT doc_no,
		       draft,
		       dept_id,
		       title,
		       cntn,
		       draft_dt,
		       draft_stat,
		       temp_id,
		       final_line,
		       now_line,
		       doc_stat,
		       cmplt_dt
		FROM doc
		WHERE doc_no = #{docNo}
	</select>
	
	<insert id="insertDoc" parameterType="DocVO">
		<selectKey keyProperty="docNo"
			       resultType="Integer"
				   order="BEFORE">
			SELECT NVL(MAX(doc_no), 0) + 1 
			FROM doc
		</selectKey>
		INSERT INTO doc
				(
					doc_no,
	                draft,
	                dept_id,
	                title,
	                <if test="cntn != null and !cntn.equals('')">
	                cntn,
	                </if>
	                temp_id,
	                final_line
				)
	  	  VALUES
	  	  		(
	  	  			#{docNo},
			        #{draft},
			        #{deptId},
			        #{title},
			        <if test="cntn != null and !cntn.equals('')">
			        #{cntn},
			        </if>
			        #{tempId},
			        #{finalLine}
			     )
	</insert>
	
	<update id="updateDoc" parameterType="DocVO">
		UPDATE doc
		SET draft = draft,
		    title = #{title},
		    <if test="cntn != null and !cntn.equals('')">
		    cntn = #{cntn},
		    </if>
		    final_line = #{finalLine}
		WHERE doc_no = #{docNo}
	</update>

</mapper>
  