<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.samjo.app.ct.mapper.CtMapper">

	<!-- 계약 전체목록 -->
	<select id="selectCtAll" resultType="CtVO"
		parameterType="SearchVO">
		SELECT r.*
		FROM (SELECT rownum rn,
			t.*
			FROM (SELECT ct.ct_no,
						ct.cust_no,
						c.cust_name,
						ct.ct_stat,
						ct.ct_start_dt,
						ct.ct_end_dt,
						ct.ct_amt,
						ct.use_mod_cnt,
						ct.max_emps,
						ct.cur_emps,
						ct.ct_file
				FROM ct ct JOIN cust c
							ON (ct.cust_no = c.cust_no)
				WHERE rownum <![CDATA[<=]]> (#{page} * 10) 
				<if test="keyword != null and keyword != ''">
					AND ${searchCondition} LIKE '%' || #{keyword} || '%'
				</if>
				<if test="ctStat != null and ctStat != ''">
					AND ct.ct_stat LIKE #{ctStat}
				</if>
				<choose>
					<when test="ctStart != null and ctEnd != null">
						AND ${ctDt} BETWEEN #{ctStart} AND #{ctEnd}
					</when>
					<when test="(ctStart != null) and (ctEnd == null)">
						AND ${ctDt} >= #{ctStart}
					</when>
					<when test="(ctEnd != null) and (ctStart == null)">						
						AND ${ctDt} <![CDATA[<=]]> #{ctEnd}
					</when>
				</choose>
				ORDER BY ${ctSort}) t ) r
		WHERE r.rn > (#{page} -1) * 10
	</select>

	<!-- 계약 페이징 -->
	<select id="ctCount" parameterType="SearchVO">
		SELECT  COUNT(*)
		FROM ct ct JOIN cust c
					ON (ct.cust_no = c.cust_no)
		<where>
			<if test="keyword != null and keyword != ''">
				AND ${searchCondition} LIKE '%' || #{keyword} || '%'
			</if>
			<if test="ctStat != null and ctStat != ''">
				AND ct.ct_stat LIKE #{ctStat}
			</if>
			<choose>
				<when test="ctStart != null and ctEnd != null">
					AND ${ctDt} BETWEEN #{ctStart} AND #{ctEnd}
				</when>
				<when test="(ctStart != null) and (ctEnd == null)">
					AND ${ctDt} >= #{ctStart}
				</when>
				<when test="(ctEnd != null) and (ctStart == null)">						
					AND ${ctDt} <![CDATA[<=]]> #{ctEnd}
				</when> 
			</choose>
		</where>
	</select>
	
</mapper>